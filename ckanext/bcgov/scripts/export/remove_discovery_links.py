# replace discovery links in 'More Information' with no link.### This script currently removes the download setting!!!## Change before running!import sysimport requestsimport jsonimport csvimport ckanapi# get total records countdomain = "http://cat.data.gov.bc.ca/"base_url = domain + 'api/3/action/package_search?rows=1001'api_key='50e89803-1903-4ddf-b2b0-1a4ab425f5d4' # cadapi_key='4ad7e53a-5bac-443e-9d5c-bc1a3407b7fb' # catheaders = {'X-CKAN-API-KEY': api_key,'content-type': 'application/json;charset=utf-8'}  request = requests.get(base_url,headers=headers)total_records_count = request.json()["result"]["count"]print('Total record count= ' + str(total_records_count))# get full list of records, because each time request can only return a max of 1000 recordsfull_record_result_list = []for i in range(0, total_records_count / 1000 + 1):    url = base_url + "&start=" + str(i) + "000"    request = requests.get(url)    results_list = request.json()["result"]["results"]    for record in results_list:        full_record_result_list.append(record) print('Full record list = ' + str(len(full_record_result_list)))#use ckan api to modify recorddemo = ckanapi.RemoteCKAN(domain,   api_key)action='package_update'with open('removeLinksCAT' + '.csv', 'a') as f:	writer = csv.writer(f)	writer.writerow(['Name','UID','Link'])	for rec in full_record_result_list:		# if rec['organization']['id'] == 'd2d2bf0a-39ac-4f9d-aeba-35c08b770cbf': #only have editor permission for EDS in Cat		try:			if 'link' in rec.get('more_info',{})[0] and (len(rec['more_info'][0]['link']) >0) and rec['more_info'][0]['link'][:26] =='http://apps.gov.bc.ca/pub/':					print rec['name']					print rec['more_info'][0]['link']					print " "					writer.writerow([rec['name'],rec['id'],rec['more_info'][0]['link']])					rec['more_info'][0]['link'] = ""					try:						demo.call_action(action,rec)					except:						e = sys.exc_info()[0]						print rec['name']						print e		except KeyError:			print 'No links to discovery here'# ## CKAN API total_records_count# import ckanapi# demo = ckanapi.RemoteCKAN('http://cad.data.gov.bc.ca/',#    api_key)# pkg = demo.action.package_show(id='bc-parks-app')# pkg['more_info'][0]['link'] = 'http://google.ca'# # pkg = demo.action.package_update(id='bc-parks-app',pkg)# # request= requests.get('http://cat.data.gov.bc.ca/api/action/package_update', headers=headers)   # ## seems to be closer to what works# action='package_update'# object = {"name":"bc-parks-app","purpose":"asdfas"}# object=pkg# demo.call_action(action,object)